---
title: Customizing web app initialization
title: 自定义 Web 应用程序的初始化
description: Customize how Flutter apps are initialized on the web
description: 自定义 Flutter 应用程序在 Web 上的初始化方式
---

You can customize how a Flutter app is initialized on the web
using the `_flutter.loader` JavaScript API provided by `flutter.js`.
This API can be used to display a loading indicator in CSS,
prevent the app from loading based on a condition,
or wait until the user presses a button before showing the app.

你可以使用 `flutter.js` 提供的 `_flutter.loader` JavaScript API 
来自定义 Flutter 应用程序在 web 上的初始化方式。
该 API 可以用于在 CSS 中显示加载指示器，
也可以根据条件阻止加载应用程序，
还可以等待用户按下按钮后再显示应用程序。

The initialization process is split into the following stages:

初始化过程分为以下阶段：

**Loading the entrypoint script**
<br>Fetches the `main.dart.js` script and initializes the service worker.

**加载入口脚本**
<br>获取 `main.dart.js` 脚本并初始化 service worker。

**Initializing the Flutter engine**
<br>Initializes Flutter's web engine by downloading required resources 
such as assets, fonts, and CanvasKit.

**初始化 Flutter 引擎**
<br>通过下载所需资源（如静态资源、字体和 CanvasKit）来初始化 Flutter web 引擎。

**Running the app**
<br>Prepares the DOM for your Flutter app and runs it.

**运行应用程序**
<br>为 Flutter 应用程序准备 DOM 并运行。

This page shows how to customize the behavior
at each stage of the initialization process.

本篇介绍了如何自定义初始化过程各个阶段的行为。

## Getting started

## 入门指南

By default, the `index.html` file
generated by the `flutter create` command
contains a script tag
that calls `loadEntrypoint` from the `flutter.js` file:

默认情况下，`flutter create` 指令生成的 `index.html` 文件
包含一个 script 标签，
用于调用 `flutter.js` 文件中的 `loadEntrypoint`：

```html
<html>
  <head>
    <!-- ... -->
    <script src="flutter.js" defer></script>
  </head>
  <body>
    <script>
      window.addEventListener('load', function (ev) {
        // Download main.dart.js
        _flutter.loader.loadEntrypoint({
          serviceWorker: {
            serviceWorkerVersion: serviceWorkerVersion,
          },
          onEntrypointLoaded: async function(engineInitializer) {
            // Initialize the Flutter engine
            let appRunner = await engineInitializer.initializeEngine();
            // Run the app
            await appRunner.runApp();
          }
        });
      });
    </script>
  </body>
</html>
```

{{site.alert.note}}

  In Flutter 2.10 or earlier,
  this script doesn't support customization.
  To upgrade your `index.html` file to the latest version,
  see [Upgrading an older project](#upgrading-an-older-project).

  在 Flutter 2.10 或更早的版本中，
  该脚本不支持自定义。
  你需要将 `index.html` 文件升级到最新版本，
  请查阅 [升级旧项目](#upgrading-an-older-project)。

{{site.alert.end}}

The `loadEntrypoint` function calls the `onEntrypointLoaded` callback
once the Service Worker is initialized, and the `main.dart.js` entrypoint
has been downloaded and run by the browser. Flutter also calls
`onEntrypointLoaded` on every hot restart during development.

一旦 Service Worker 初始化，且浏览器下载并运行了 `main.dart.js` 入口，
`loadEntrypoint` 函数就会调用 `onEntrypointLoaded` 回调。
Flutter 还会在开发过程中每次热重载时调用 `onEntrypointLoaded`。

The `onEntrypointLoaded` callback receives an **engine initializer** object as
its only parameter. Use the engine initializer to set the run-time
configuration, and start the Flutter Web engine.

`onEntrypointLoaded` 回调接收一个 **engine initializer** 对象作为唯一参数。
使用 engine initializer 设置运行时的配置，并启动 Flutter Web 引擎。

The `initializeEngine()` function returns a [`Promise`][js-promise]
that resolves with an **app runner** object. The app runner has a
single method, `runApp()`, that runs the Flutter app.

`initializeEngine()` 函数返回一个
包含了 **app runner** 对象的 [`Promise`][js-promise]。
app runner 只有一个 `runApp()` 方法，它用于运行 Flutter 应用程序。

[js-promise]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise

## Customizing web app initialization

## 自定义 web 应用程序的初始化

In this section,
learn how to customize each stage of your app’s initialization.

在本节中，
了解如何自定义应用程序初始化的各个阶段。

### Loading the entrypoint

### 加载入口

The `loadEntrypoint` method accepts these parameters:

`loadEntrypoint` 方法接受以下参数：

<div class="table-wrapper" markdown="1">

| <t>Name</t><t>参数名称</t> | <t>Description</t><t>描述</t> | <t>JS&nbsp;Type</t><t>JS&nbsp;类型</t> |
|-|-|-|
|`entrypointUrl`| The URL of your Flutter app's entrypoint. Defaults to `"main.dart.js"`. |`String`|
|`entrypointUrl`| Flutter 应用程序入口的 URL。默认为 `"main.dart.js"`。 |`String`|
|`onEntrypointLoaded`| The function called when the engine is ready to be initialized. Receives an `engineInitializer` object as its only parameter. |`Function`|
|`onEntrypointLoaded`| 当引擎准备初始化时调用的函数。该函数的唯一参数是一个 `engineInitializer` 对象。  |`Function`|
|`serviceWorker`| The configuration for the `flutter_service_worker.js` loader. (If not set, the service worker won’t be used.) |`Object`|
|`serviceWorker`| `flutter_service_worker.js` 加载器的配置。（如果未设置，则不会使用 service worker）。 |`Object`|
{:.table}

</div>

The `serviceWorker` JavaScript object accepts the following properties:

`serviceWorker` JavaScript 对象接受以下属性：

<div class="table-wrapper" markdown="1">

| <t>Name</t><t>属性名称</t> | <t>Description</t><t>描述</t> | <t>JS&nbsp;Type</t><t>JS&nbsp;类型</t> |
|-|-|-|
|`serviceWorkerUrl`| The URL of the Service Worker JS file. The `serviceWorkerVersion` is appended to the URL. Defaults to `"flutter_service_worker.js?v="` |`String`|
|`serviceWorkerUrl`| Service Worker JS 文件的 URL。`serviceWorkerVersion` 会附加到 URL 中。默认为 `"flutter_service_worker.js?v="`。 |`String`|
|`serviceWorkerVersion`| Pass *the `serviceWorkerVersion` variable* set by the build process in your **`index.html`** file. |`String`|
|`serviceWorkerVersion`| 构建过程会赋值 *`serviceWorkerVersion` 变量* 并在 **`index.html`** 中运用。 |`String`|
|`timeoutMillis`| The timeout value for the service worker load. Defaults to `4000`. |`Number`|
|`timeoutMillis`| service worker 负载的超时时间（毫秒）。默认为 `4000`。 |`Number`|
{:.table}

</div>

### Initializing the engine

### 初始化引擎

As of _Flutter 3.7.0_, you can use the `initializeEngine` method to
configure several run-time options of the Flutter web engine through a
plain JavaScript object.

从 `Flutter 3.7.0 版本` 起，
你可以使用 `initializeEngine` 方法通过纯 JavaScript 对象
配置 Flutter web 引擎的多个运行时选项。

You can add any of the following optional parameters:

你可以添加以下任何可选参数：

<div class="table-wrapper" markdown="1">

| <t>Name</t><t>参数名称</t> | <t>Description</t><t>描述</t> | <t>Dart&nbsp;Type</t><t>Dart&nbsp;类型</t> |
|-|-|-|
|`assetBase`| The base URL of the `assets` directory of the app. Add this when Flutter loads from a different domain or subdirectory than the actual web app. You might need this when you embed Flutter web into another app, or when you deploy its assets to a CDN. |`String`|
|`assetBase`| 应用程序 `assets` 目录的根 URL。当 Flutter 从实际 web 应用不同的域或子目录加载时，请添加此 URL。当你将 Flutter web 嵌入另一个应用程序，或将其静态资源部署到 CDN 时，可能需要使用此 URL。 |`String`|
|`canvasKitBaseUrl`| The base URL from where `canvaskit.wasm` is downloaded. |`String`|
|`canvasKitBaseUrl`| 下载 `canvaskit.wasm` 的根 URL。 |`String`|
|`canvasKitVariant`| The CanvasKit variant to download. Your options cover:<br><br>1. `auto`: Downloads the optimal variant for the browser. The option defaults to this value.<br>2. `full`: Downloads the full variant of CanvasKit that works in all browsers.<br>3. `chromium`: Downloads a smaller variant of CanvasKit that uses Chromium compatible APIs. **_Warning_**: Don't use the `chromium` option unless you plan on only using Chromium-based browsers. |`String`|
|`canvasKitVariant`| 下载 CanvasKit。你的可选值：<br><br>1. `auto`：为浏览器下载最佳版本。（默认值）<br>2. `full`：下载适用于所有浏览器的 CanvasKit 完整版。<br>3. `chromium`：下载较小的 CanvasKit，该版本使用与 Chromium 兼容的 API。**_警告_**：除非你只打算使用基于 Chromium 的浏览器，否则不要使用 `chromium` 值。 |`String`|
|`canvasKitForceCpuOnly`| When `true`, forces CPU-only rendering in CanvasKit (the engine won't use WebGL). |`bool`|
|`canvasKitForceCpuOnly`| 为 `true` 时，强制在 CanvasKit 中只使用 CPU 进行渲染（引擎不会使用 WebGL）。 |`bool`|
|`canvasKitMaximumSurfaces`| The maximum number of overlay surfaces that the CanvasKit renderer can use. |`double`|
|`canvasKitMaximumSurfaces`| CanvasKit 渲染器可使用的最大覆盖层数。 |`double`|
|`debugShowSemanticNodes`| If `true`, Flutter visibly renders the semantics tree onscreen (for debugging).  |`bool`|
|`debugShowSemanticNodes`| 如果为 `true`，Flutter 会在屏幕上明显呈现 semantics 语义树（用于调试）。 |`bool`|
|`hostElement`| HTML Element into which Flutter renders the app. When not set, Flutter web takes over the whole page. |`HtmlElement`|
|`hostElement`| 用于 Flutter 渲染应用程序的 HTML 元素。未设置时，Flutter web 会占据整个页面。 |`HtmlElement`|
|`renderer`| Specifies the [web renderer][web-renderers] for the current Flutter application, either `"canvaskit"` or `"html"`. |`String`|
|`renderer`| 指定当前 Flutter 应用程序的 [web 渲染器][web-renderers]，可选 `"canvaskit"` 或 `"html"`。 |`String`|
{:.table}

</div>

[jsflutterconfig-source]: {{site.github}}/flutter/engine/blob/main/lib/web_ui/lib/src/engine/configuration.dart#L247-L259
[web-renderers]: {{site.url}}/platform-integration/web/renderers

{{site.alert.note}}

  Some of the parameters described above might have been overridden
  in previous releases by using properties in the `window` object.
  That approach is still supported, but displays a **deprecation
  notice** in the JS console, as of **Flutter 3.7.0**.

  在以前的版本中，上述某些参数可能是通过使用 `window` 对象中的属性来覆盖的。
  从 **Flutter 3.7.0 版本** 起，这种方式仍然支持，
  但会在 JS 控制台中显示 **弃用通知**。

{{site.alert.end}}

#### Engine configuration example

#### 引擎配置示例

The `initializeEngine` method lets you pass any of the configuration
parameters described above to your Flutter app.

通过 `initializeEngine` 方法，
你可以向 Flutter 应用程序传递上述任何配置参数。

Consider the following example.

请看下面这个例子。

Your Flutter app should target an HTML element with `id="flutter_app"` and
use the `canvaskit` renderer. The resulting JavaScript code would resemble
the following:

你的 Flutter 应用程序使用 `id="flutter_app"` 的 HTML 元素，
并使用 `canvaskit` 渲染器。
JavaScript 代码就像下面这样：

```js
onEntrypointLoaded: async function(engineInitializer) {
  let appRunner = await engineInitializer.initializeEngine({
    hostElement: document.querySelector("#flutter_app"),
    renderer: "canvaskit"
  });
  appRunner.runApp();
}
```

For a more detailed explanation of each parameter, take a look at the
**"Runtime parameters"** documentation section of the [`configuration.dart`][config-dart]
file of the web engine.

有关每个参数的详细解释，
请查阅 web 引擎 [`configuration.dart`][config-dart] 文件中，
文档的 **"Runtime parameters"** 部分。

[config-dart]: {{site.github}}/flutter/engine/blob/main/lib/web_ui/lib/src/engine/configuration.dart#L174

#### Skipping this step

#### 跳过此步骤

Instead of calling `initializeEngine()` on the engine initializer (and then
`runApp()` on the application runner), you can call `autoStart()` to
initialize the engine with its default configuration, and then start the app
immediately after the initialization is complete:

与其在 engine initializer 上调用 `initializeEngine()` 
（然后在 app runner 上调用 `runApp()`），
不如调用 `autoStart()` 以默认配置初始化引擎，
然后在初始化完成后立即启动应用程序。

```js
_flutter.loader.loadEntrypoint({
  serviceWorker: {
    serviceWorkerVersion: serviceWorkerVersion,
  },
  onEntrypointLoaded: async function(engineInitializer) {
    await engineInitializer.autoStart();
  }
});
```

## Example: Display a progress indicator

## 示例：显示进度指示器

To give the user of your application feedback
during the initialization process,
use the hooks provided for each stage to update the DOM:

为了在应用程序初始化过程中向用户提供反馈，
请使用各个阶段提供的钩子来更新 DOM：

```html
<html>
  <head>
    <!-- ... -->
    <script src="flutter.js" defer></script>
  </head>
  <body>
    <div id="loading"></div>
    <script>
      window.addEventListener('load', function(ev) {
        var loading = document.querySelector('#loading');
        loading.textContent = "Loading entrypoint...";
        _flutter.loader.loadEntrypoint({
          serviceWorker: {
            serviceWorkerVersion: serviceWorkerVersion,
          },
          onEntrypointLoaded: async function(engineInitializer) {
            loading.textContent = "Initializing engine...";
            let appRunner = await engineInitializer.initializeEngine();

            loading.textContent = "Running app...";
            await appRunner.runApp();
          }
        });
      });
    </script>
  </body>
</html>
```

For a more practical example using CSS animations,
see the [initialization code][gallery-init] for the Flutter Gallery.

更多关于实用的 CSS 动画示例，
请查阅 Flutter Gallery 的 [初始化代码][gallery-init]。

[gallery-init]: {{site.github}}/flutter/gallery/blob/master/web/index.html

## Upgrading an older project

## 升级旧项目

If your project was created in Flutter 2.10 or earlier,
you can create a new `index.html` file
with the latest initialization template by running
`flutter create` as follows.

如果你的项目是在 Flutter 2.10 或更早版本中创建的，
你可以通过运行 `flutter create` 指令
创建一个带有最新初始化模板的 `index.html` 文件，
方法如下。

First, remove the files from your `/web` directory.

首先，删除 `/web` 目录中的文件。

Then, from your project directory, run the following:

然后，在项目目录下运行以下指令：

```
$ flutter create . --platforms=web
```
